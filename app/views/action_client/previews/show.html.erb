<%
    http_headers = preview.request.headers.reduce({}) do |rewritten_headers, (key, value)|
      if key.starts_with?("HTTP_") || ActionDispatch::Http::Headers::CGI_VARIABLES.include?(key)
        rewritten_headers[key.sub(%r{\AHTTP_}, "").titleize.gsub(" ", "-")] = value
      end

      rewritten_headers
    end
%>
<%= link_to action_client_engine.client_path(client) do %>
  <%= client.client_name %>
<% end %>

<h1>
  <%= client.client_name %>#<%= preview.action_name %>
</h1>

<h2>
  cURL
</h2>

<pre>
curl \
  --request <%= preview.request.request_method %> \
  <% http_headers.each do |key, value| %>
  --header "<%= key %>: <%= value %>" \
  <% end %>
  --data '<%= preview.request.body.read.strip %>' \
  <%= preview.request.original_url %>
</pre>

<h2>
  HTTP Action
</h2>

<pre>
<%= preview.request.request_method %> <%= preview.request.original_url %>
</pre>

<h2>
  Headers
</h2>

<pre>
  <% http_headers.each do |key, value| %>
<%= key %>: <%= value %>
  <% end %>
</pre>

<h2>
  Body
</h2>

<pre>
<%= JSON.pretty_generate(JSON.parse(preview.request.body.read)) %>
</pre>
